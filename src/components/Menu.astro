<div id="side-menu" class="hidden lg:flex fixed top-1/2 right-0 transform -translate-y-1/2 p-2 rounded-l-lg text-white k z-50">
  <nav class="w-64 p-6">
    <ul class="space-y-4 flex flex-col items-center p-4 gap-1">
      <li class="w-full hover:bg-violet-900 dark:hover:bg-blue-900 dark:hover:border-gray-300 hover:scale-110 transition-all duration-300 rounded-lg border hover:shadow-purple-800 dark:hover:shadow-sky-800 dark:border-blue-900 hover:shadow-lg overflow-hidden">
        <a href="#top" class="dark:hover:text-white dark:text-black w-full flex justify-center text-xl py-2 transition-colors text-color rounded-lg block " data-translate="header.home">Inicio</a>
      </li>
      <li class="w-full hover:bg-violet-900 dark:hover:bg-blue-900 dark:hover:border-gray-300 hover:scale-110 transition-all duration-300 rounded-lg border dark:border-blue-900 hover:shadow-lg overflow-hidden hover:shadow-purple-800 dark:hover:shadow-sky-800">
        <a href="#experience" class="dark:hover:text-white dark:text-black w-full flex justify-center text-xl py-2 transition-colors text-color rounded-lg block  " data-translate="header.experience">Experiencia</a>
      </li>
      <li class="w-full hover:bg-violet-900 dark:hover:bg-blue-900 dark:hover:border-gray-300 hover:scale-110 transition-all duration-300 rounded-lg border dark:border-blue-900 hover:shadow-lg overflow-hidden hover:shadow-purple-800 dark:hover:shadow-sky-800">
        <a href="#proyectos" class="dark:hover:text-white dark:text-black w-full flex justify-center text-xl py-2 transition-colors text-color rounded-lg block  hover:shadow-lg" data-translate="header.projects">Proyectos</a>
      </li>
      <li class="w-full hover:bg-violet-900 dark:hover:bg-blue-900 dark:hover:border-gray-300 hover:scale-110 transition-all duration-300 rounded-lg border dark:border-blue-900 hover:shadow-lg overflow-hidden hover:shadow-purple-800 dark:hover:shadow-sky-800">
        <a href="#sobremi" class="dark:hover:text-white dark:text-black w-full flex justify-center text-xl py-2 transition-colors text-color rounded-lg block  hover:shadow-lg" data-translate="header.about">Sobre mí</a>
      </li> 
      <li class="w-full hover:bg-violet-900 dark:hover:bg-blue-900 dark:hover:border-gray-300 hover:scale-110 transition-all duration-300 rounded-lg border dark:border-blue-900 hover:shadow-lg overflow-hidden hover:shadow-purple-800 dark:hover:shadow-sky-800">
        <a href="#contactos" class="dark:hover:text-white dark:text-black w-full flex justify-center text-xl py-2 transition-colors text-color rounded-lg block hover:shadow-lg" data-translate="header.contact">Contacto</a>
      </li>
    </ul>
  </nav>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sideNav = document.getElementById('side-menu');
    
    if (!sideNav) return; 
    
    const navLinks = sideNav.querySelectorAll('a'); 

    window.addEventListener('scroll', () => {
      let current = '';
      const sections = document.querySelectorAll('.scroll-spy-section');
      const scrollPosition = window.pageYOffset + (window.innerHeight / 2.5);

      sections.forEach(section => {
        if (section.offsetHeight > 0) {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.offsetHeight;

            if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                current = section.getAttribute('id');
            }
        }
      });
      
      if (['skills', 'education', 'certificate'].includes(current)) {
        current = 'sobremi';
      }

      navLinks.forEach(link => {
        const listItem = link.parentElement;

        // --- INICIO DE LA CORRECCIÓN DIRECTA ---

        // 1. Limpiamos los estilos de "activo" de todos los elementos
        listItem.classList.remove('bg-violet-900', 'dark:bg-blue-900');
        
        // [CAMBIO 1]: Reseteamos el estilo en línea para que el enlace vuelva a su color por defecto
        link.style.color = ''; 

        // 2. Aplicamos los estilos de "activo" SOLO al elemento correcto
        if (current && link.getAttribute('href').includes(current)) {
          listItem.classList.add('bg-violet-900', 'dark:bg-blue-900');
          
          // [CAMBIO 2]: Forzamos el color del texto a blanco con un estilo en línea.
          // Esto tiene la máxima prioridad y resolverá el conflicto.
          link.style.color = 'white';
        }

        // --- FIN DE LA CORRECCIÓN DIRECTA ---
      });
      
    }, { passive: true });
  });
</script>